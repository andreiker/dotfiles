#!/usr/bin/expect

send_user "workDB.kdbx Password: "
stty -echo
expect_user -timeout -1 -re "(.*)\n" { set dbpassword $expect_out(1,string) }
send_user "\n"
stty echo

set login [exec echo "$dbpassword" | keepassxc-cli show -s -q "/home/andrew/misc/creds/workDB.kdbx" AWS | awk "FNR == 2 {print \$2}"]
set password [exec echo "$dbpassword" | keepassxc-cli show -s -q "/home/andrew/misc/creds/workDB.kdbx" AWS | awk "FNR == 3 {print \$2}"]

send_user "Connect-AWS logging in...\n"
log_user 0
spawn pwsh -Command Connect-AWS -UserName "$login" -Password \"$password\"
log_user 1

interact
